const translations = {
    en: {
        "home.title": "TellMe",
        "home.subtitle": "Create a temporary link to receive anonymous messages.",
        "home.name_label": "Your Name (Optional)",
        "home.name_placeholder": "e.g. John Doe",
        "home.duration_label": "Duration",
        "home.generate_btn": "Generate Links",
        "home.generating": "Generating...",
        "home.result_title": "Your Links are Ready!",
        "home.public_label": "Public Link (Share this)",
        "home.private_label": "Private Inbox Link (Keep secret)",
        "home.copy": "Copy",
        "home.copied": "Copied!",
        "home.expiration_text": "These links will expire in <span id='durationText'></span>.",
        "home.view_inbox": "View Inbox Now",
        "public.loading": "Loading...",
        "public.link_expired": "Link Expired",
        "public.session_inactive": "This session is no longer active.",
        "public.go_home": "Go Home",
        "public.send_title": "Send a Message",
        "public.subtitle_prefix": "Send an anonymous message to",
        "public.message_placeholder": "Type your anonymous message here...",
        "public.send_btn": "Send Message",
        "public.sending": "Sending...",
        "public.sent_title": "Sent!",
        "public.sent_desc": "Your message has been delivered anonymously.",
        "public.send_another": "Send Another",
        "public.get_own_link_text": "Want to receive anonymous messages?",
        "public.get_own_link_btn": "Get your own link",
        "private.loading": "Loading...",
        "private.inbox_title": "Inbox",
        "private.subtitle_prefix": "Messages for",
        "private.messages_count": "Messages",
        "private.refresh": "Refresh",
        "private.empty_state": "No messages yet... share your public link!",
        "private.anonymous": "Anonymous",
        "private.expires_in": "Expires in:",
        "footer.rights": "© TellMe 2026",
    },
    ar: {
        "home.title": "صارحني",
        "home.subtitle": "أنشئ رابطًا مؤقتًا لاستقبال رسائل مجهولة.",
        "home.name_label": "اسمك (اختياري)",
        "home.name_placeholder": "مثال: أحمد محمد",
        "home.duration_label": "المدة",
        "home.generate_btn": "إنشاء الروابط",
        "home.generating": "جاري الإنشاء...",
        "home.result_title": "روابطك جاهزة!",
        "home.public_label": "الرابط العام (للمشاركة)",
        "home.private_label": "رابط الصندوق الخاص (سري)",
        "home.copy": "نسخ",
        "home.copied": "تم النسخ!",
        "home.expiration_text": "ستنتهي صلاحية هذه الروابط خلال <span id='durationText'></span>.",
        "home.view_inbox": "عرض صندوق الوارد الآن",
        "public.loading": "جاري التحميل...",
        "public.link_expired": "الرابط منتهي",
        "public.session_inactive": "هذه الجلسة لم تعد نشطة.",
        "public.go_home": "الذهاب للرئيسية",
        "public.send_title": "أرسل رسالة",
        "public.subtitle_prefix": "أرسل رسالة مجهولة إلى",
        "public.message_placeholder": "اكتب رسالتك المجهولة هنا...",
        "public.send_btn": "إرسال الرسالة",
        "public.sending": "جاري الإرسال...",
        "public.sent_title": "تم الإرسال!",
        "public.sent_desc": "تم توصيل رسالتك بشكل مجهول.",
        "public.send_another": "أرسل رسالة أخرى",
        "public.get_own_link_text": "هل تريد استقبال رسائل مجهولة؟",
        "public.get_own_link_btn": "احصل على رابطك الخاص",
        "private.loading": "جاري التحميل...",
        "private.inbox_title": "صندوق الوارد",
        "private.subtitle_prefix": "رسائل لـ",
        "private.messages_count": "رسائل",
        "private.refresh": "تحديث",
        "private.empty_state": "لا توجد رسائل بعد... شارك رابطك العام!",
        "private.anonymous": "مجهول",
        "private.expires_in": "ينتهي خلال:",
        "footer.rights": "© صارحني 2026",
    },
    es: {
        "home.title": "DimeAlgo",
        "home.subtitle": "Crea un enlace temporal para recibir mensajes anónimos.",
        "home.name_label": "Tu Nombre (Opcional)",
        "home.name_placeholder": "ej. Juan Pérez",
        "home.duration_label": "Duración",
        "home.generate_btn": "Generar Enlaces",
        "home.generating": "Generando...",
        "home.result_title": "¡Tus Enlaces están Listos!",
        "home.public_label": "Enlace Público (Compartir)",
        "home.private_label": "Enlace Privado (Secreto)",
        "home.copy": "Copiar",
        "home.copied": "¡Copiado!",
        "home.expiration_text": "Estos enlaces expirarán en <span id='durationText'></span>.",
        "home.view_inbox": "Ver Bandeja de Entrada",
        "public.loading": "Cargando...",
        "public.link_expired": "Enlace Expirado",
        "public.session_inactive": "Esta sesión ya no está activa.",
        "public.go_home": "Ir al Inicio",
        "public.send_title": "Enviar un Mensaje",
        "public.subtitle_prefix": "Envía un mensaje anónimo a",
        "public.message_placeholder": "Escribe tu mensaje anónimo aquí...",
        "public.send_btn": "Enviar Mensaje",
        "public.sending": "Enviando...",
        "public.sent_title": "¡Enviado!",
        "public.sent_desc": "Tu mensaje ha sido entregado anónimamente.",
        "public.send_another": "Enviar Otro",
        "public.get_own_link_text": "¿Quieres recibir mensajes anónimos?",
        "public.get_own_link_btn": "Obtén tu propio enlace",
        "private.loading": "Cargando...",
        "private.inbox_title": "Bandeja de Entrada",
        "private.subtitle_prefix": "Mensajes para",
        "private.messages_count": "Mensajes",
        "private.refresh": "Actualizar",
        "private.empty_state": "No hay mensajes aún... ¡comparte tu enlace público!",
        "private.anonymous": "Anónimo",
        "private.expires_in": "Expira en:",
        "footer.rights": "© DimeAlgo 2026",
    }
};

const savedLang = localStorage.getItem('appLang') || 'en';

function setLanguage(lang) {
    if (!translations[lang]) lang = 'en'; // Fallback

    // Update State
    localStorage.setItem('appLang', lang);
    document.documentElement.lang = lang;
    document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

    // Apply Translations
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (translations[lang][key]) {
            // Check if element has child nodes that are not text (like the span in home.expiration_text)
            // If so, we might need a safer way, but for now innerHTML allows the span
            if (element.children.length > 0 && key === 'home.expiration_text') {
                // Special case to preserve the span or re-insert it
                // Actually, the key includes the span HTML in my translation dict above for this specific case
                element.innerHTML = translations[lang][key];
            } else {
                element.textContent = translations[lang][key];
            }
        }
    });

    // Update Placeholders
    document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        if (translations[lang][key]) {
            element.placeholder = translations[lang][key];
        }
    });

    // Update active button state
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === lang);
    });

    // Trigger event for dynamic updates (like timer label) if needed
    window.dispatchEvent(new CustomEvent('languageChanged', { detail: lang }));
}

function initLanguage() {
    setLanguage(savedLang);
}

// Language Switcher Component Logic
function createLanguageSwitcher() {
    const switcher = document.createElement('div');
    switcher.className = 'lang-switcher';

    ['en', 'ar', 'es'].forEach(lang => {
        const btn = document.createElement('button');
        btn.textContent = lang.toUpperCase();
        btn.dataset.lang = lang;
        btn.className = 'lang-btn';
        if (lang === savedLang) btn.classList.add('active');

        btn.onclick = () => setLanguage(lang);
        switcher.appendChild(btn);
    });

    document.body.appendChild(switcher);
}

document.addEventListener('DOMContentLoaded', () => {
    createLanguageSwitcher();
    initLanguage();
});
